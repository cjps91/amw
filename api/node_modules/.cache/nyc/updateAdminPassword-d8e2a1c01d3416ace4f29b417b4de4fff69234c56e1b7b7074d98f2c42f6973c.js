function cov_1d909xyzv5(){var path="/home/carlos/workspace/isdi-parttime-202303/staff/carlos-perez/fullstack/project/api/logic/administrator/updateAdminPassword.js";var hash="5bca2ff9f5ba6ca8710563592c2a1968695993d4";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/carlos/workspace/isdi-parttime-202303/staff/carlos-perez/fullstack/project/api/logic/administrator/updateAdminPassword.js",statementMap:{"0":{start:{line:4,column:4},end:{line:4,column:18}},"1":{start:{line:5,column:26},end:{line:5,column:54}},"2":{start:{line:6,column:15},end:{line:6,column:34}},"3":{start:{line:8,column:0},end:{line:31,column:1}},"4":{start:{line:9,column:4},end:{line:9,column:34}},"5":{start:{line:10,column:4},end:{line:10,column:30}},"6":{start:{line:11,column:4},end:{line:11,column:49}},"7":{start:{line:12,column:4},end:{line:12,column:69}},"8":{start:{line:14,column:4},end:{line:14,column:119}},"9":{start:{line:14,column:41},end:{line:14,column:119}},"10":{start:{line:16,column:4},end:{line:30,column:6}},"11":{start:{line:17,column:8},end:{line:17,column:72}},"12":{start:{line:17,column:20},end:{line:17,column:72}},"13":{start:{line:19,column:22},end:{line:19,column:66}},"14":{start:{line:21,column:8},end:{line:21,column:57}},"15":{start:{line:21,column:20},end:{line:21,column:57}},"16":{start:{line:23,column:27},end:{line:23,column:74}},"17":{start:{line:25,column:8},end:{line:25,column:73}},"18":{start:{line:25,column:23},end:{line:25,column:73}},"19":{start:{line:27,column:8},end:{line:27,column:58}},"20":{start:{line:29,column:8},end:{line:29,column:27}}},fnMap:{"0":{name:"updateUserEmail",decl:{start:{line:8,column:26},end:{line:8,column:41}},loc:{start:{line:8,column:94},end:{line:31,column:1}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:16,column:48},end:{line:16,column:49}},loc:{start:{line:16,column:59},end:{line:30,column:5}},line:16}},branchMap:{"0":{loc:{start:{line:14,column:4},end:{line:14,column:119}},type:"if",locations:[{start:{line:14,column:4},end:{line:14,column:119}},{start:{line:14,column:4},end:{line:14,column:119}}],line:14},"1":{loc:{start:{line:17,column:8},end:{line:17,column:72}},type:"if",locations:[{start:{line:17,column:8},end:{line:17,column:72}},{start:{line:17,column:8},end:{line:17,column:72}}],line:17},"2":{loc:{start:{line:21,column:8},end:{line:21,column:57}},type:"if",locations:[{start:{line:21,column:8},end:{line:21,column:57}},{start:{line:21,column:8},end:{line:21,column:57}}],line:21},"3":{loc:{start:{line:25,column:8},end:{line:25,column:73}},type:"if",locations:[{start:{line:25,column:8},end:{line:25,column:73}},{start:{line:25,column:8},end:{line:25,column:73}}],line:25}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"5bca2ff9f5ba6ca8710563592c2a1968695993d4"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1d909xyzv5=function(){return actualCoverage;};}return actualCoverage;}cov_1d909xyzv5();const{validators:{validateId,validatePassword},errors:{ExistenceError,ContentError,AuthError}}=(cov_1d909xyzv5().s[0]++,require('com'));const{Administrator}=(cov_1d909xyzv5().s[1]++,require('../../data/models'));const bcrypt=(cov_1d909xyzv5().s[2]++,require('bcryptjs'));cov_1d909xyzv5().s[3]++;module.exports=function updateUserEmail(adminId,password,newPassword,newPasswordConfirm){cov_1d909xyzv5().f[0]++;cov_1d909xyzv5().s[4]++;validateId(adminId,'User ID');cov_1d909xyzv5().s[5]++;validatePassword(password);cov_1d909xyzv5().s[6]++;validatePassword(newPassword,'New password');cov_1d909xyzv5().s[7]++;validatePassword(newPasswordConfirm,'New password confirmation');cov_1d909xyzv5().s[8]++;if(newPassword!==newPasswordConfirm){cov_1d909xyzv5().b[0][0]++;cov_1d909xyzv5().s[9]++;throw new ContentError('New password and confirmation do NOT match. Check it');}else{cov_1d909xyzv5().b[0][1]++;}cov_1d909xyzv5().s[10]++;return Administrator.findById(adminId).then(admin=>{cov_1d909xyzv5().f[1]++;cov_1d909xyzv5().s[11]++;if(!admin){cov_1d909xyzv5().b[1][0]++;cov_1d909xyzv5().s[12]++;throw new ExistenceError('Administrator not found!');}else{cov_1d909xyzv5().b[1][1]++;}const match=(cov_1d909xyzv5().s[13]++,bcrypt.compareSync(password,admin.password));cov_1d909xyzv5().s[14]++;if(!match){cov_1d909xyzv5().b[2][0]++;cov_1d909xyzv5().s[15]++;throw new AuthError('Wrong password');}else{cov_1d909xyzv5().b[2][1]++;}const matchReuse=(cov_1d909xyzv5().s[16]++,bcrypt.compareSync(newPassword,admin.password));cov_1d909xyzv5().s[17]++;if(matchReuse){cov_1d909xyzv5().b[3][0]++;cov_1d909xyzv5().s[18]++;throw new ContentError('Do NOT use old passwords');}else{cov_1d909xyzv5().b[3][1]++;}cov_1d909xyzv5().s[19]++;admin.password=bcrypt.hashSync(newPassword,10);cov_1d909xyzv5().s[20]++;return admin.save();});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMWQ5MDl4eXp2NSIsImFjdHVhbENvdmVyYWdlIiwidmFsaWRhdG9ycyIsInZhbGlkYXRlSWQiLCJ2YWxpZGF0ZVBhc3N3b3JkIiwiZXJyb3JzIiwiRXhpc3RlbmNlRXJyb3IiLCJDb250ZW50RXJyb3IiLCJBdXRoRXJyb3IiLCJzIiwicmVxdWlyZSIsIkFkbWluaXN0cmF0b3IiLCJiY3J5cHQiLCJtb2R1bGUiLCJleHBvcnRzIiwidXBkYXRlVXNlckVtYWlsIiwiYWRtaW5JZCIsInBhc3N3b3JkIiwibmV3UGFzc3dvcmQiLCJuZXdQYXNzd29yZENvbmZpcm0iLCJmIiwiYiIsImZpbmRCeUlkIiwidGhlbiIsImFkbWluIiwibWF0Y2giLCJjb21wYXJlU3luYyIsIm1hdGNoUmV1c2UiLCJoYXNoU3luYyIsInNhdmUiXSwic291cmNlcyI6WyJ1cGRhdGVBZG1pblBhc3N3b3JkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHtcbiAgICB2YWxpZGF0b3JzOiB7IHZhbGlkYXRlSWQsIHZhbGlkYXRlUGFzc3dvcmQgfSxcbiAgICBlcnJvcnM6IHsgRXhpc3RlbmNlRXJyb3IsIENvbnRlbnRFcnJvciwgQXV0aEVycm9yIH1cbn0gPSByZXF1aXJlKCdjb20nKVxuY29uc3QgeyBBZG1pbmlzdHJhdG9yIH0gPSByZXF1aXJlKCcuLi8uLi9kYXRhL21vZGVscycpXG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHRqcycpXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gdXBkYXRlVXNlckVtYWlsKGFkbWluSWQsIHBhc3N3b3JkLCBuZXdQYXNzd29yZCwgbmV3UGFzc3dvcmRDb25maXJtKSB7XG4gICAgdmFsaWRhdGVJZChhZG1pbklkLCAnVXNlciBJRCcpXG4gICAgdmFsaWRhdGVQYXNzd29yZChwYXNzd29yZClcbiAgICB2YWxpZGF0ZVBhc3N3b3JkKG5ld1Bhc3N3b3JkLCAnTmV3IHBhc3N3b3JkJylcbiAgICB2YWxpZGF0ZVBhc3N3b3JkKG5ld1Bhc3N3b3JkQ29uZmlybSwgJ05ldyBwYXNzd29yZCBjb25maXJtYXRpb24nKVxuXG4gICAgaWYobmV3UGFzc3dvcmQhPT1uZXdQYXNzd29yZENvbmZpcm0pIHRocm93IG5ldyBDb250ZW50RXJyb3IoJ05ldyBwYXNzd29yZCBhbmQgY29uZmlybWF0aW9uIGRvIE5PVCBtYXRjaC4gQ2hlY2sgaXQnKVxuXG4gICAgcmV0dXJuIEFkbWluaXN0cmF0b3IuZmluZEJ5SWQoYWRtaW5JZCkudGhlbigoYWRtaW4pID0+IHtcbiAgICAgICAgaWYgKCFhZG1pbikgdGhyb3cgbmV3IEV4aXN0ZW5jZUVycm9yKCdBZG1pbmlzdHJhdG9yIG5vdCBmb3VuZCEnKVxuXG4gICAgICAgIGNvbnN0IG1hdGNoID0gYmNyeXB0LmNvbXBhcmVTeW5jKHBhc3N3b3JkLCBhZG1pbi5wYXNzd29yZClcblxuICAgICAgICBpZiAoIW1hdGNoKSB0aHJvdyBuZXcgQXV0aEVycm9yKCdXcm9uZyBwYXNzd29yZCcpXG5cbiAgICAgICAgY29uc3QgbWF0Y2hSZXVzZSA9IGJjcnlwdC5jb21wYXJlU3luYyhuZXdQYXNzd29yZCwgYWRtaW4ucGFzc3dvcmQpXG5cbiAgICAgICAgaWYobWF0Y2hSZXVzZSkgdGhyb3cgbmV3IENvbnRlbnRFcnJvcignRG8gTk9UIHVzZSBvbGQgcGFzc3dvcmRzJylcblxuICAgICAgICBhZG1pbi5wYXNzd29yZCA9IGJjcnlwdC5oYXNoU3luYyhuZXdQYXNzd29yZCwgMTApO1xuXG4gICAgICAgIHJldHVybiBhZG1pbi5zYXZlKClcbiAgICB9KVxufSJdLCJtYXBwaW5ncyI6IjZsR0FlWTtBQUFBQSxjQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGNBQUEsR0FmWixLQUFNLENBQ0ZFLFVBQVUsQ0FBRSxDQUFFQyxVQUFVLENBQUVDLGdCQUFpQixDQUFDLENBQzVDQyxNQUFNLENBQUUsQ0FBRUMsY0FBYyxDQUFFQyxZQUFZLENBQUVDLFNBQVUsQ0FDdEQsQ0FBQyxFQUFBUixjQUFBLEdBQUFTLENBQUEsTUFBR0MsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUNsQixLQUFNLENBQUVDLGFBQWMsQ0FBQyxFQUFBWCxjQUFBLEdBQUFTLENBQUEsTUFBR0MsT0FBTyxDQUFDLG1CQUFtQixDQUFDLEVBQ3RELEtBQU0sQ0FBQUUsTUFBTSxFQUFBWixjQUFBLEdBQUFTLENBQUEsTUFBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFBVixjQUFBLEdBQUFTLENBQUEsTUFFbENJLE1BQU0sQ0FBQ0MsT0FBTyxDQUFHLFFBQVMsQ0FBQUMsZUFBZUEsQ0FBQ0MsT0FBTyxDQUFFQyxRQUFRLENBQUVDLFdBQVcsQ0FBRUMsa0JBQWtCLENBQUUsQ0FBQW5CLGNBQUEsR0FBQW9CLENBQUEsTUFBQXBCLGNBQUEsR0FBQVMsQ0FBQSxNQUMxRk4sVUFBVSxDQUFDYSxPQUFPLENBQUUsU0FBUyxDQUFDLENBQUFoQixjQUFBLEdBQUFTLENBQUEsTUFDOUJMLGdCQUFnQixDQUFDYSxRQUFRLENBQUMsQ0FBQWpCLGNBQUEsR0FBQVMsQ0FBQSxNQUMxQkwsZ0JBQWdCLENBQUNjLFdBQVcsQ0FBRSxjQUFjLENBQUMsQ0FBQWxCLGNBQUEsR0FBQVMsQ0FBQSxNQUM3Q0wsZ0JBQWdCLENBQUNlLGtCQUFrQixDQUFFLDJCQUEyQixDQUFDLENBQUFuQixjQUFBLEdBQUFTLENBQUEsTUFFakUsR0FBR1MsV0FBVyxHQUFHQyxrQkFBa0IsQ0FBRSxDQUFBbkIsY0FBQSxHQUFBcUIsQ0FBQSxTQUFBckIsY0FBQSxHQUFBUyxDQUFBLFdBQU0sSUFBSSxDQUFBRixZQUFZLENBQUMsc0RBQXNELENBQUMsQ0FBRCxDQUFDLEtBQUFQLGNBQUEsR0FBQXFCLENBQUEsVUFBQXJCLGNBQUEsR0FBQVMsQ0FBQSxPQUVuSCxNQUFPLENBQUFFLGFBQWEsQ0FBQ1csUUFBUSxDQUFDTixPQUFPLENBQUMsQ0FBQ08sSUFBSSxDQUFFQyxLQUFLLEVBQUssQ0FBQXhCLGNBQUEsR0FBQW9CLENBQUEsTUFBQXBCLGNBQUEsR0FBQVMsQ0FBQSxPQUNuRCxHQUFJLENBQUNlLEtBQUssQ0FBRSxDQUFBeEIsY0FBQSxHQUFBcUIsQ0FBQSxTQUFBckIsY0FBQSxHQUFBUyxDQUFBLFlBQU0sSUFBSSxDQUFBSCxjQUFjLENBQUMsMEJBQTBCLENBQUMsQ0FBRCxDQUFDLEtBQUFOLGNBQUEsR0FBQXFCLENBQUEsVUFFaEUsS0FBTSxDQUFBSSxLQUFLLEVBQUF6QixjQUFBLEdBQUFTLENBQUEsT0FBR0csTUFBTSxDQUFDYyxXQUFXLENBQUNULFFBQVEsQ0FBRU8sS0FBSyxDQUFDUCxRQUFRLENBQUMsRUFBQWpCLGNBQUEsR0FBQVMsQ0FBQSxPQUUxRCxHQUFJLENBQUNnQixLQUFLLENBQUUsQ0FBQXpCLGNBQUEsR0FBQXFCLENBQUEsU0FBQXJCLGNBQUEsR0FBQVMsQ0FBQSxZQUFNLElBQUksQ0FBQUQsU0FBUyxDQUFDLGdCQUFnQixDQUFDLENBQUQsQ0FBQyxLQUFBUixjQUFBLEdBQUFxQixDQUFBLFVBRWpELEtBQU0sQ0FBQU0sVUFBVSxFQUFBM0IsY0FBQSxHQUFBUyxDQUFBLE9BQUdHLE1BQU0sQ0FBQ2MsV0FBVyxDQUFDUixXQUFXLENBQUVNLEtBQUssQ0FBQ1AsUUFBUSxDQUFDLEVBQUFqQixjQUFBLEdBQUFTLENBQUEsT0FFbEUsR0FBR2tCLFVBQVUsQ0FBRSxDQUFBM0IsY0FBQSxHQUFBcUIsQ0FBQSxTQUFBckIsY0FBQSxHQUFBUyxDQUFBLFlBQU0sSUFBSSxDQUFBRixZQUFZLENBQUMsMEJBQTBCLENBQUMsQ0FBRCxDQUFDLEtBQUFQLGNBQUEsR0FBQXFCLENBQUEsVUFBQXJCLGNBQUEsR0FBQVMsQ0FBQSxPQUVqRWUsS0FBSyxDQUFDUCxRQUFRLENBQUdMLE1BQU0sQ0FBQ2dCLFFBQVEsQ0FBQ1YsV0FBVyxDQUFFLEVBQUUsQ0FBQyxDQUFDbEIsY0FBQSxHQUFBUyxDQUFBLE9BRWxELE1BQU8sQ0FBQWUsS0FBSyxDQUFDSyxJQUFJLENBQUMsQ0FBQyxDQUN2QixDQUFDLENBQUMsQ0FDTixDQUFDIn0=