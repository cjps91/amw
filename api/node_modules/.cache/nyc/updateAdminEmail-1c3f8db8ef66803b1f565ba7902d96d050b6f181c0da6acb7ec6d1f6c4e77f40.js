function cov_l9q4opffb(){var path="/home/carlos/workspace/isdi-parttime-202303/staff/carlos-perez/fullstack/project/api/logic/administrator/updateAdminEmail.js";var hash="7903f64bb8b247f3390fac3f33edd7b6382259a7";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/carlos/workspace/isdi-parttime-202303/staff/carlos-perez/fullstack/project/api/logic/administrator/updateAdminEmail.js",statementMap:{"0":{start:{line:4,column:4},end:{line:4,column:18}},"1":{start:{line:5,column:26},end:{line:5,column:54}},"2":{start:{line:7,column:2},end:{line:30,column:3}},"3":{start:{line:9,column:4},end:{line:9,column:34}},"4":{start:{line:10,column:4},end:{line:10,column:33}},"5":{start:{line:11,column:4},end:{line:11,column:40}},"6":{start:{line:12,column:4},end:{line:12,column:60}},"7":{start:{line:14,column:4},end:{line:15,column:74}},"8":{start:{line:15,column:6},end:{line:15,column:74}},"9":{start:{line:17,column:4},end:{line:18,column:77}},"10":{start:{line:18,column:6},end:{line:18,column:77}},"11":{start:{line:21,column:4},end:{line:29,column:6}},"12":{start:{line:22,column:6},end:{line:22,column:70}},"13":{start:{line:22,column:18},end:{line:22,column:70}},"14":{start:{line:24,column:6},end:{line:24,column:70}},"15":{start:{line:24,column:33},end:{line:24,column:70}},"16":{start:{line:26,column:6},end:{line:26,column:27}},"17":{start:{line:28,column:6},end:{line:28,column:25}}},fnMap:{"0":{name:"updateAdminEmail",decl:{start:{line:7,column:28},end:{line:7,column:44}},loc:{start:{line:8,column:2},end:{line:30,column:3}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:21,column:48},end:{line:21,column:49}},loc:{start:{line:21,column:59},end:{line:29,column:5}},line:21}},branchMap:{"0":{loc:{start:{line:14,column:4},end:{line:15,column:74}},type:"if",locations:[{start:{line:14,column:4},end:{line:15,column:74}},{start:{line:14,column:4},end:{line:15,column:74}}],line:14},"1":{loc:{start:{line:17,column:4},end:{line:18,column:77}},type:"if",locations:[{start:{line:17,column:4},end:{line:18,column:77}},{start:{line:17,column:4},end:{line:18,column:77}}],line:17},"2":{loc:{start:{line:22,column:6},end:{line:22,column:70}},type:"if",locations:[{start:{line:22,column:6},end:{line:22,column:70}},{start:{line:22,column:6},end:{line:22,column:70}}],line:22},"3":{loc:{start:{line:24,column:6},end:{line:24,column:70}},type:"if",locations:[{start:{line:24,column:6},end:{line:24,column:70}},{start:{line:24,column:6},end:{line:24,column:70}}],line:24}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"7903f64bb8b247f3390fac3f33edd7b6382259a7"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_l9q4opffb=function(){return actualCoverage;};}return actualCoverage;}cov_l9q4opffb();const{validators:{validateId,validateEmail},errors:{ExistenceError,ContentError}}=(cov_l9q4opffb().s[0]++,require('com'));const{Administrator}=(cov_l9q4opffb().s[1]++,require('../../data/models'));cov_l9q4opffb().s[2]++;module.exports=function updateAdminEmail(adminId,email,newEmail,newEmailConfirm){cov_l9q4opffb().f[0]++;cov_l9q4opffb().s[3]++;validateId(adminId,'User ID');cov_l9q4opffb().s[4]++;validateEmail(email,'email');cov_l9q4opffb().s[5]++;validateEmail(newEmail,'New email');cov_l9q4opffb().s[6]++;validateEmail(newEmailConfirm,'New email confirmation');cov_l9q4opffb().s[7]++;if(newEmail!==newEmailConfirm){cov_l9q4opffb().b[0][0]++;cov_l9q4opffb().s[8]++;throw new Error('The new email does NOT match the confirmation one');}else{cov_l9q4opffb().b[0][1]++;}cov_l9q4opffb().s[9]++;if(newEmail===email){cov_l9q4opffb().b[1][0]++;cov_l9q4opffb().s[10]++;throw new Error('Do NOT use your old email as the new one. Change it.');}else{cov_l9q4opffb().b[1][1]++;}cov_l9q4opffb().s[11]++;return Administrator.findById(adminId).then(admin=>{cov_l9q4opffb().f[1]++;cov_l9q4opffb().s[12]++;if(!admin){cov_l9q4opffb().b[2][0]++;cov_l9q4opffb().s[13]++;throw new ExistenceError('Administrator not found!');}else{cov_l9q4opffb().b[2][1]++;}cov_l9q4opffb().s[14]++;if(admin.email!==email){cov_l9q4opffb().b[3][0]++;cov_l9q4opffb().s[15]++;throw new ContentError('Wrong email');}else{cov_l9q4opffb().b[3][1]++;}cov_l9q4opffb().s[16]++;admin.email=newEmail;cov_l9q4opffb().s[17]++;return admin.save();});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfbDlxNG9wZmZiIiwiYWN0dWFsQ292ZXJhZ2UiLCJ2YWxpZGF0b3JzIiwidmFsaWRhdGVJZCIsInZhbGlkYXRlRW1haWwiLCJlcnJvcnMiLCJFeGlzdGVuY2VFcnJvciIsIkNvbnRlbnRFcnJvciIsInMiLCJyZXF1aXJlIiwiQWRtaW5pc3RyYXRvciIsIm1vZHVsZSIsImV4cG9ydHMiLCJ1cGRhdGVBZG1pbkVtYWlsIiwiYWRtaW5JZCIsImVtYWlsIiwibmV3RW1haWwiLCJuZXdFbWFpbENvbmZpcm0iLCJmIiwiYiIsIkVycm9yIiwiZmluZEJ5SWQiLCJ0aGVuIiwiYWRtaW4iLCJzYXZlIl0sInNvdXJjZXMiOlsidXBkYXRlQWRtaW5FbWFpbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7XG4gICAgdmFsaWRhdG9yczogeyB2YWxpZGF0ZUlkLHZhbGlkYXRlRW1haWwgfSxcbiAgICBlcnJvcnM6IHtFeGlzdGVuY2VFcnJvciwgQ29udGVudEVycm9yfVxufSA9IHJlcXVpcmUoJ2NvbScpXG5jb25zdCB7IEFkbWluaXN0cmF0b3IgfSA9IHJlcXVpcmUoJy4uLy4uL2RhdGEvbW9kZWxzJylcbiAgXG4gIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gdXBkYXRlQWRtaW5FbWFpbChhZG1pbklkLGVtYWlsLG5ld0VtYWlsLG5ld0VtYWlsQ29uZmlybSkgXG4gIHtcbiAgICB2YWxpZGF0ZUlkKGFkbWluSWQsICdVc2VyIElEJylcbiAgICB2YWxpZGF0ZUVtYWlsKGVtYWlsLCAnZW1haWwnKVxuICAgIHZhbGlkYXRlRW1haWwobmV3RW1haWwsICdOZXcgZW1haWwnKVxuICAgIHZhbGlkYXRlRW1haWwobmV3RW1haWxDb25maXJtLCAnTmV3IGVtYWlsIGNvbmZpcm1hdGlvbicpXG4gIFxuICAgIGlmIChuZXdFbWFpbCAhPT0gbmV3RW1haWxDb25maXJtKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgbmV3IGVtYWlsIGRvZXMgTk9UIG1hdGNoIHRoZSBjb25maXJtYXRpb24gb25lJylcbiAgXG4gICAgaWYgKG5ld0VtYWlsID09PSBlbWFpbClcbiAgICAgIHRocm93IG5ldyBFcnJvcignRG8gTk9UIHVzZSB5b3VyIG9sZCBlbWFpbCBhcyB0aGUgbmV3IG9uZS4gQ2hhbmdlIGl0LicpXG4gIFxuICBcbiAgICByZXR1cm4gQWRtaW5pc3RyYXRvci5maW5kQnlJZChhZG1pbklkKS50aGVuKChhZG1pbikgPT4ge1xuICAgICAgaWYgKCFhZG1pbikgdGhyb3cgbmV3IEV4aXN0ZW5jZUVycm9yKCdBZG1pbmlzdHJhdG9yIG5vdCBmb3VuZCEnKVxuICBcbiAgICAgIGlmIChhZG1pbi5lbWFpbCAhPT0gZW1haWwpIHRocm93IG5ldyBDb250ZW50RXJyb3IoJ1dyb25nIGVtYWlsJylcblxuICAgICAgYWRtaW4uZW1haWw9bmV3RW1haWw7XG4gIFxuICAgICAgcmV0dXJuIGFkbWluLnNhdmUoKVxuICAgIH0pXG4gIH0iXSwibWFwcGluZ3MiOiJpNUZBZVk7QUFBQUEsYUFBQSxTQUFBQSxDQUFBLFNBQUFDLGNBQUEsV0FBQUEsY0FBQSxFQUFBRCxhQUFBLEdBZlosS0FBTSxDQUNGRSxVQUFVLENBQUUsQ0FBRUMsVUFBVSxDQUFDQyxhQUFjLENBQUMsQ0FDeENDLE1BQU0sQ0FBRSxDQUFDQyxjQUFjLENBQUVDLFlBQVksQ0FDekMsQ0FBQyxFQUFBUCxhQUFBLEdBQUFRLENBQUEsTUFBR0MsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUNsQixLQUFNLENBQUVDLGFBQWMsQ0FBQyxFQUFBVixhQUFBLEdBQUFRLENBQUEsTUFBR0MsT0FBTyxDQUFDLG1CQUFtQixDQUFDLEVBQUFULGFBQUEsR0FBQVEsQ0FBQSxNQUVwREcsTUFBTSxDQUFDQyxPQUFPLENBQUcsUUFBUyxDQUFBQyxnQkFBZ0JBLENBQUNDLE9BQU8sQ0FBQ0MsS0FBSyxDQUFDQyxRQUFRLENBQUNDLGVBQWUsQ0FDakYsQ0FBQWpCLGFBQUEsR0FBQWtCLENBQUEsTUFBQWxCLGFBQUEsR0FBQVEsQ0FBQSxNQUNFTCxVQUFVLENBQUNXLE9BQU8sQ0FBRSxTQUFTLENBQUMsQ0FBQWQsYUFBQSxHQUFBUSxDQUFBLE1BQzlCSixhQUFhLENBQUNXLEtBQUssQ0FBRSxPQUFPLENBQUMsQ0FBQWYsYUFBQSxHQUFBUSxDQUFBLE1BQzdCSixhQUFhLENBQUNZLFFBQVEsQ0FBRSxXQUFXLENBQUMsQ0FBQWhCLGFBQUEsR0FBQVEsQ0FBQSxNQUNwQ0osYUFBYSxDQUFDYSxlQUFlLENBQUUsd0JBQXdCLENBQUMsQ0FBQWpCLGFBQUEsR0FBQVEsQ0FBQSxNQUV4RCxHQUFJUSxRQUFRLEdBQUtDLGVBQWUsQ0FDOUIsQ0FBQWpCLGFBQUEsR0FBQW1CLENBQUEsU0FBQW5CLGFBQUEsR0FBQVEsQ0FBQSxXQUFNLElBQUksQ0FBQVksS0FBSyxDQUFDLG1EQUFtRCxDQUFDLENBQUQsQ0FBQyxLQUFBcEIsYUFBQSxHQUFBbUIsQ0FBQSxVQUFBbkIsYUFBQSxHQUFBUSxDQUFBLE1BRXRFLEdBQUlRLFFBQVEsR0FBS0QsS0FBSyxDQUNwQixDQUFBZixhQUFBLEdBQUFtQixDQUFBLFNBQUFuQixhQUFBLEdBQUFRLENBQUEsWUFBTSxJQUFJLENBQUFZLEtBQUssQ0FBQyxzREFBc0QsQ0FBQyxDQUFELENBQUMsS0FBQXBCLGFBQUEsR0FBQW1CLENBQUEsVUFBQW5CLGFBQUEsR0FBQVEsQ0FBQSxPQUd6RSxNQUFPLENBQUFFLGFBQWEsQ0FBQ1csUUFBUSxDQUFDUCxPQUFPLENBQUMsQ0FBQ1EsSUFBSSxDQUFFQyxLQUFLLEVBQUssQ0FBQXZCLGFBQUEsR0FBQWtCLENBQUEsTUFBQWxCLGFBQUEsR0FBQVEsQ0FBQSxPQUNyRCxHQUFJLENBQUNlLEtBQUssQ0FBRSxDQUFBdkIsYUFBQSxHQUFBbUIsQ0FBQSxTQUFBbkIsYUFBQSxHQUFBUSxDQUFBLFlBQU0sSUFBSSxDQUFBRixjQUFjLENBQUMsMEJBQTBCLENBQUMsQ0FBRCxDQUFDLEtBQUFOLGFBQUEsR0FBQW1CLENBQUEsVUFBQW5CLGFBQUEsR0FBQVEsQ0FBQSxPQUVoRSxHQUFJZSxLQUFLLENBQUNSLEtBQUssR0FBS0EsS0FBSyxDQUFFLENBQUFmLGFBQUEsR0FBQW1CLENBQUEsU0FBQW5CLGFBQUEsR0FBQVEsQ0FBQSxZQUFNLElBQUksQ0FBQUQsWUFBWSxDQUFDLGFBQWEsQ0FBQyxDQUFELENBQUMsS0FBQVAsYUFBQSxHQUFBbUIsQ0FBQSxVQUFBbkIsYUFBQSxHQUFBUSxDQUFBLE9BRWhFZSxLQUFLLENBQUNSLEtBQUssQ0FBQ0MsUUFBUSxDQUFDaEIsYUFBQSxHQUFBUSxDQUFBLE9BRXJCLE1BQU8sQ0FBQWUsS0FBSyxDQUFDQyxJQUFJLENBQUMsQ0FBQyxDQUNyQixDQUFDLENBQUMsQ0FDSixDQUFDIn0=